<!DOCTYPE html>
<html>
<head>
    <!-- Carga de Clappr -->
    <script src="//cdn.jsdelivr.net/npm/@clappr/player@0.8/dist/clappr.min.js"></script>
    <!-- Carga de la librería P2P de Swarmcloud (para HLS.js) -->
    <script src="//cdn.jsdelivr.net/npm/@swarmcloud/hls/p2p-engine.min.js"></script>
    
    <link rel="stylesheet" type="text/css" href="https://la12hd.com/cssm.css">
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/e/e9/Win%2B_F%C3%BAtbol_logo.svg">
    <title>Win+ Fútbol (Clappr + P2P)</title>
    
    <style>
        html, body {
            margin: 0; 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            overflow: hidden;
        }
        #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
<div id="player"></div>

<script>
    /* Nueva URL que queremos reproducir, igual que con JW Player */
    var playbackURL = "http://45.137.206.120:8089/play/hls/eyJpdiI6Im1lSFRmdS9SaUorUXY5QXB5emYra0E9PSIsInZhbHVlIjoibHUrcktTNWZBdXB6VnM4MXVFRWh4aVl0UEM5c1RxN0ZIelN4d080YzhrcjNxN0xNNktrT0FkcnZaM0FkYzViMCIsIm1hYyI6ImE5OTg2MGUzMjJmODA1MzM5M2RiYWMyOTNlZDBmNWEwZjAxMzA0NDQzMzhjMTM1NDY2Yjc4OGE1OTBlNDU5YmIiLCJ0YWciOiIifQ==/be609419-a9e1-471e-8144-8df2c2290f30.m3u8?lvtoken=eyJpdiI6InYrcHlkcE9nV3JzYk1uRDBmUWtTSkE9PSIsInZhbHVlIjoialUrRkVjZDVKamptL1BaMVFsN0txeTZqdUtDRWlhZ0p0RjlacWgvek0rWVBoV2hYQXBvSUlNTFZHVTNWcW03MzhzMEc2ZTJubWY1L3BDdnpyK215WDd6b2Q5TmtmWDVkRWtlMzhMTi85ODdhM2hOSW00MjBucmNmc3V1bmdmbGtaOTZWMERZbVRNV3p0Vi8wcmQ2WHdiblh6VjZsSlBldXQ5ZC9VS3BjVVY4bEtqSyt1dG9vRWNqUHMvWk1SRWYrdW9GdVpNNVA4aVA3Yml0RXNjSURiUT09IiwibWFjIjoiMTNmNjg0MzkzNGIyYjYwZTk1NTg4MGE1N2RjYWEzZTMwOTMwYWMwNmI4NzY2OTQ3YzNhYzQ1NjAwOTAxNmI0OCIsInRhZyI6IiJ9&r=06a307&rt=6ba56e71afbc6a418156df8a892b1b4b";

    // Configuración básica para el P2P
    var p2pConfig = {
        live: true,         // Indica transmisión en vivo
        trackerZone: 'us',  // Zona del tracker
    };

    // 1) Intentamos registrar el Service Worker de P2P
    //    -> Esto sólo funciona bajo HTTPS o localhost
    P2PEngineHls.tryRegisterServiceWorker(p2pConfig).then(() => {

        // 2) Creamos el reproductor Clappr
        var player = new Clappr.Player({
            source: playbackURL,
            parentId: "#player",
            poster: '',
            width: '100%',
            height: '100%',
            autoPlay: true,    // Ten en cuenta las políticas de autoplay
            mediacontrol: {
                seekbar: "#D4ED31",
                buttons: "#FFFFFF"
            },
            plugins: []        // si tuvieras otros plugins de Clappr, los incluirías
        });

        // 3) Vinculamos la instancia interna de HLS.js con el P2P Engine
        p2pConfig.hlsjsInstance = player.core.getCurrentPlayback()?._hls;
        var engine = new P2PEngineHls(p2pConfig);

    }).catch(err => {
        console.error("Error al registrar SW para P2P:", err);
        // Si falla, podrías cargar Clappr sin P2P como fallback:
        var player = new Clappr.Player({
            source: playbackURL,
            parentId: "#player",
            width: '100%',
            height: '100%',
            autoPlay: true
        });
    });

</script>
</body>
</html>
